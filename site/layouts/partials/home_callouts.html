{{/* Get posts that define featured_callout as a number >= 0 */}}
{{ $featured := where .Site.RegularPages ".Params.featured_callout" "ge" 0 }}

{{/* Sort by date (newest first) */}}
{{ $featured := sort $featured "Date" "desc" }}

{{/* Take only the first post */}}
{{ with first 1 $featured }}
  {{ $post := index . 0 }}

  {{/* Ensure it has callouts */}}
  {{ $callouts := $post.Params.callouts }}
  {{ if $callouts }}

    {{/* Selected callout index (default 0) */}}
    {{ $idx := $post.Params.featured_callout | default 0 }}

    {{/* Pick safely: fallback to first callout */}}
    {{ $callout := cond (lt $idx (len $callouts)) (index $callouts $idx) (index $callouts 0) }}

<section class="home-callouts">
  <div class="home-callout">

    <div class="open-quote">
      <img src="{{ "img/open_quote.svg" | relURL }}">
    </div>

    <div class="callout-text">
      "{{ $callout | markdownify | safeHTML }}"
    </div>

    <div class="callout-meta">
      {{ with $post.Params.author }}
        <span class="callout-author">{{ delimit . ", " }}</span>
      {{ end }}

      <span class="callout-title">
        <a href="{{ $post.Permalink }}">{{ $post.Title }}</a>
      </span>

      <span class="callout-lacritica">La Cr√≠tica del Derecho</span>

      {{ $months := dict "1" "enero" "2" "febrero" "3" "marzo" "4" "abril" "5" "mayo" "6" "junio" "7" "julio" "8" "agosto" "9" "septiembre" "10" "octubre" "11" "noviembre" "12" "diciembre" }}
      {{ $day := $post.Date.Format "2" }}
      {{ $month := index $months ($post.Date.Format "1") }}
      {{ $year := $post.Date.Format "2006" }}

      <span class="callout-date">{{ $day }} de {{ $month }} de {{ $year }}</span>
    </div>

    <div class="close-quote">
      <img src="{{ "img/close_quote.svg" | relURL }}">
    </div>

  </div>
</section>

  {{ end }}
{{ end }}
