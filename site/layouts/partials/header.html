<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {{ $.Scratch.Set "Title" (default .Title (index .Site.Params.text (print "title_" (lower .Title)))) }}
    <title>
      {{ if eq ($.Scratch.Get "Title") .Site.Title }}
        {{ .Site.Title }}
      {{ else }}
        {{ ($.Scratch.Get "Title") }} | {{ .Site.Title }}
      {{ end }}
    </title>

    <link rel="stylesheet" href="{{ "css/style.css" | relURL }}">
    <link rel="stylesheet" href="{{ "css/fonts.css" | relURL }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.1.0/css/all.min.css">
    <link rel="stylesheet" href="{{ "css/custom.css" | relURL }}">
    {{ partial "head_custom.html" . }}
  </head>

  <body{{ if .IsPage }} class="page"{{ end }}>
    <header class="header">
      <div class="banner">
        <a href="{{ "/" | relURL }}" class="logo-link">
          {{ partial "logo.svg" . }}
        </a>
      </div>
    </header>

    <div class="taxonomy-bar">
      <!-- Small logo (only visible when scrolled) -->
      <a href="{{ "/" | relURL }}" class="taxonomy-logo">
        <img src="{{ "/img/logo_small.svg" | relURL }}" alt="Logo">
      </a>

      <div class="taxonomy-list">
      {{ with .Site.Taxonomies.categories }}
        <ul>
          {{ range $key, $value := . }}
            <li><a href="{{ "/categories/" | relURL }}{{ $key | urlize }}">{{ $key }}</a></li>
          {{ end }}
        </ul>
      </div>
      {{ end }}

      <!-- Hamburger button -->
      <button id="menu-toggle" aria-label="Toggle menu">
        <img src="{{ "img/three_lines.svg" | relURL }}" alt="Menu toggle icon" class="menu-icon">
      </button>
    </div>

    <!-- Collapsible menu -->
    <nav id="menu" class="hidden">
      <button id="menu-close" aria-label="Close menu">✕</button>
      <ul>
        <input type="text" id="search-box" placeholder="Search...">
        <li><ul id="search-results"></ul></li>
        <li><a href="/categories/debates/">debates</a></li>
        <li><a href="/categories/ensayos/">ensayos</a></li>
        <li><a href="/categories/reseñas/">reseñas</a></li>
        <li><a href="/categories/simposios/">simposios</a></li>
        <li><a href="/autores/">autores</a></li>
        <li><a href="/quienes_somos/">quienes somos</a></li>
        <li><a href="/contáctenos/">contáctenos</a></li>
      </ul>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/flexsearch@latest/dist/flexsearch.bundle.js"></script>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("menu-toggle");
      const menu = document.getElementById("menu");
      const closeBtn = document.getElementById("menu-close");
      const searchBox = document.getElementById("search-box");
      const searchResults = document.getElementById("search-results");

      // MENU TOGGLE — NEW LOGIC
btn.addEventListener("click", (e) => {
  e.stopPropagation();
  menu.classList.remove("hidden");           // make visible
  requestAnimationFrame(() => {
    menu.style.transform = "translateX(0)";  // slide in
  });
});

// Ensure clicks inside menu don’t close it
menu.addEventListener("click", (e) => e.stopPropagation());

// Close button
closeBtn.addEventListener("click", () => {
  menu.style.transform = "translateX(100%)"; // slide out
  setTimeout(() => menu.classList.add("hidden"), 300);
});

// Click outside to close
document.addEventListener("click", () => {
  if (!menu.classList.contains("hidden")) {
    menu.style.transform = "translateX(100%)";
    setTimeout(() => menu.classList.add("hidden"), 300);
  }
});

      // FlexSearch setup
      const index = new FlexSearch.Document({
        document: {
          id: "url",
          index: ["title", "content"],
          store: ["title", "url"]
        }
      });

      fetch("/index.json")
        .then(res => res.json())
        .then(data => data.forEach(page => index.add(page)));

      // Search input listener
      searchBox.addEventListener("input", async (e) => {
        const query = e.target.value;
        const results = await index.searchAsync(query, { enrich: true });

        searchResults.innerHTML = "";
        results.forEach(group => {
          group.result.forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = `<a href="${item.url}">${item.title}</a>`;
            searchResults.appendChild(li);
          });
        });
      });

      // Scroll behavior for taxonomy bar
      const bar = document.querySelector(".taxonomy-bar");
      const smallLogo = document.querySelector(".taxonomy-logo");
      let lastScroll = 0;

      window.addEventListener("scroll", () => {
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

        if (currentScroll <= 0) {
          bar.classList.remove("hidden", "visible");
          smallLogo.classList.remove("show");
          return;
        }

        if (currentScroll > lastScroll && currentScroll > 100) {
          // Scrolling down
          bar.classList.add("hidden");
          bar.classList.remove("visible");
          smallLogo.classList.remove("show");
        } else {
          // Scrolling up
          bar.classList.remove("hidden");
          bar.classList.add("visible");
          smallLogo.classList.add("show");
        }

        lastScroll = currentScroll;
      });
    });
    </script>
  </body>
</html>
